# Dockerfile for GenOps AI demo application with observability
FROM python:3.11-slim

WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements first for better caching
COPY pyproject.toml /app/
RUN pip install -e ".[openai,anthropic,dev]"

# Install additional demo dependencies
RUN pip install \
    fastapi==0.104.1 \
    uvicorn[standard]==0.24.0 \
    redis==5.0.1 \
    prometheus-client==0.19.0

# Copy source code
COPY src/ /app/src/
COPY examples/ /app/examples/

# Copy demo application
COPY observability/demo-app.py /app/demo-app.py

# Set environment variables for OpenTelemetry
ENV PYTHONPATH=/app/src
ENV OTEL_PYTHON_LOGGING_AUTO_INSTRUMENTATION_ENABLED=true

# Expose port
EXPOSE 8000

# Run the demo application
CMD ["python", "demo-app.py"]